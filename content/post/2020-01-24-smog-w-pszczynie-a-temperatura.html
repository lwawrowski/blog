---
title: Smog w Pszczynie a temperatura powietrza
author: Łukasz
date: '2020-01-24'
slug: smog-w-pszczynie-a-temperatura
categories:
  - R
tags:
  - smog
  - pszczyna
  - gioś
  - imgw
  - tidyverse
description: ''
---



<p>Zjawisko smogu oraz niskiej emisji jest w ostatnim czasie tematem bardzo często poruszanym przez wszystkie media. Na stronach <a href="http://powietrze.gios.gov.pl/pjp/archives">Głównego Inspektoratu Ochrony Środowiska</a> można znaleźć historyczne dane dotyczące zanieczyszczenia powietrza. Dodatkowo <a href="https://danepubliczne.imgw.pl/">Instytut Meteorologii i Gospodarki Wodnej</a> publikuje archiwalne dane pogodowe. Są one dostępne także poprzez pakiet R o nazwie <a href="">imgw</a>. Można także na bieżąco monitorować sytuację pogodową korzystając z <a href="https://danepubliczne.imgw.pl/apiinfo">API</a>.</p>
<p>Dane są, zatem na przykładzie miasta <a href="https://pl.wikipedia.org/wiki/Pszczyna">Pszczyna</a> w województwie śląskim zobaczymy co można z nich wydobyć.</p>
<div id="jakosc-powietrza" class="section level1">
<h1>Jakość powietrza</h1>
<p>Stacja w Pszczynie zbiera dane od 2015 roku i znajduje się przy ulicy Bogedaina. Niestety zbiera informacje wyłącznie na temat stężenia pyłu PM10. Dane o jakości powietrza udostępniane są w postaci plików Excela i niezbędne informacje trzeba z nich wydobyć. Zrobiłem to ręcznie i do R wczytałem jeden plik ze wszystkimi danymi. Przy okazji uporządkowałem daty i na podstawie <a href="http://www.gios.gov.pl/pl/aktualnosci/294-normy-dla-pylow-drobnych-w-polsce">wartości norm pyłów</a> sklasyfikowałem odpowiednie wartości.</p>
<pre class="r"><code>library(tidyverse)
library(readxl)
library(lubridate)

pm10_2015 &lt;- read_xlsx(&quot;data/pm10_pszczyna.xlsx&quot;, sheet = &quot;2015&quot;)
pm10_2016 &lt;- read_xlsx(&quot;data/pm10_pszczyna.xlsx&quot;, sheet = &quot;2016&quot;)
pm10_2017 &lt;- read_xlsx(&quot;data/pm10_pszczyna.xlsx&quot;, sheet = &quot;2017&quot;)
pm10_2018 &lt;- read_xlsx(&quot;data/pm10_pszczyna.xlsx&quot;, sheet = &quot;2018&quot;)
pm10_2019 &lt;- read_xlsx(&quot;data/pm10_pszczyna.xlsx&quot;, sheet = &quot;2019&quot;) %&gt;% 
  mutate(pm10=as.numeric(str_replace(pm10, &quot;,&quot;, &quot;.&quot;)))

pm10_pszczyna &lt;- union_all(pm10_2015, pm10_2016) %&gt;% 
  union_all(., pm10_2017) %&gt;% 
  union_all(., pm10_2018) %&gt;% 
  union_all(., pm10_2019) %&gt;% 
  mutate(data=as_date(data),
         dzien_tyg=factor(wday(data),
                          levels = 1:7, 
                          labels = c(&quot;Pn&quot;, &quot;Wt&quot;, &quot;Śr&quot;, &quot;Czw&quot;, &quot;Pt&quot;, &quot;Sb&quot;, &quot;Nd&quot;),
                          ordered = T),
         kwartal=str_c(&quot;Kwartał &quot;, quarter(data)),
         rok=as.factor(year(data)),
         poziom=cut(x = pm10,
                    breaks = c(0,50,200,300,Inf), 
                    labels = c(&quot;w normie&quot;, &quot;dopuszczalny&quot;, &quot;informowania&quot;, &quot;alarmowy&quot;), 
                    ordered_result = T))</code></pre>
<p>W pierwszej kolejności ocenimy kompletność danych pod kątem liczby braków danych w każdym z analizowanych lat.</p>
<pre class="r"><code>pm10_pszczyna %&gt;% 
  filter(is.na(pm10)) %&gt;% 
  count(rok) %&gt;% 
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">rok</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2015</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">2016</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">2017</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">2018</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">2019</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
<p>Niestety z niewiadomych przyczyn brakuje pomiarów dla kilku dni w każdym roku. Aż 17 dni w roku 2016 nie była zbierana informacja o stężeniu PM10. W pozostałych latach są to pojedyncze dni i nie stanowią znaczącej wartości względem całego roku. Te obserwacje zostaną z analizy wyeliminowane. Alternatywnie można zastosować wybraną metodę imputacji danych.</p>
<p>Następnie przeanalizujemy wartości stężenia PM10 w ujęciu czasowym.</p>
<pre class="r"><code>pm10_pszczyna %&gt;% 
  filter(!is.na(pm10)) %&gt;% 
  ggplot(aes(x=data, y = pm10, color = poziom)) +
  geom_point() +
  scale_color_manual(name = &quot;Poziom&quot;, values = c(&quot;#1a9850&quot;, &quot;#fdae61&quot;, &quot;#d73027&quot;, &quot;#67001f&quot;)) +
  xlab(&quot;Data&quot;) +
  ylab(&quot;Stężenie PM10&quot;) +
  ggtitle(&quot;Stężenie pyłu PM10 w Pszczynie w latach 2015-2019&quot;) +
  labs(caption = &quot;Łukasz Wawrowski - wawrowski.edu.pl&quot;) +
  theme_light() +
  theme(legend.position = &quot;bottom&quot;,
        plot.caption = element_text(color = &quot;grey80&quot;))</code></pre>
<p><img src="/post/2020-01-24-smog-w-pszczynie-a-temperatura_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Dla lat 2015-2019 wyraźnie widać kolejne pory roku - zimą stężenie pyłów PM10 jest wysokie, a latem niskie i nie przekracza normatywnego poziomu. Pod kątem rekordowo wysokich wartości warty odnotowania jest rok 2016 i 2017. Trzy najwyższe wartości występowały kolejno w dniach 9,10,11 stycznia 2017 roku.</p>
<p>Warto bliżej się przyjrzeć zdefiniowanym normom i częstości występowania.</p>
<pre class="r"><code>pm10_pszczyna %&gt;% 
  filter(!is.na(pm10)) %&gt;% 
  count(rok, poziom) %&gt;% 
  complete(rok, poziom, fill = list(n = 0)) %&gt;% 
  ggplot(aes(x = poziom, y = rok, fill = n)) +
  geom_tile() +
  geom_text(aes(label=n)) +
  scale_fill_gradientn(colours = RColorBrewer::brewer.pal(4, &quot;RdYlGn&quot;) , name = &quot;Liczba dni&quot;) +
  xlab(&quot;Poziom&quot;) +
  ylab(&quot;Rok&quot;) +
  ggtitle(&quot;Liczba dni w roku z danym poziomem stężenia pyłu PM10&quot;) +
  labs(caption = &quot;Łukasz Wawrowski - wawrowski.edu.pl&quot;) +
  theme_light() +
  theme(plot.caption = element_text(color = &quot;grey80&quot;))</code></pre>
<p><img src="/post/2020-01-24-smog-w-pszczynie-a-temperatura_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>W ostatnich 5 latach nie nastąpiła żadne spektakularne zwiększenie liczby dni ze stężeniem PM10 w normie. Można jedynie odnotować, że w latach 2018-2019 PM10 nie przekroczyły poziomu alarmowego.</p>
<p>Spójrzymy jeszcze na te same dane w ujęciu procentowych.</p>
<pre class="r"><code>pm10_pszczyna %&gt;% 
  filter(!is.na(pm10)) %&gt;% 
  count(rok, poziom) %&gt;% 
  complete(rok, poziom, fill = list(n = 0)) %&gt;% 
  group_by(rok) %&gt;% 
  mutate(proc=round(n/sum(n)*100,1)) %&gt;% 
  ggplot(aes(x = poziom, y = rok, fill = proc)) +
  geom_tile() +
  geom_text(aes(label=proc)) +
  scale_fill_gradientn(colours = RColorBrewer::brewer.pal(4, &quot;RdYlGn&quot;), name = &quot;Odsetek&quot;) +
  xlab(&quot;Poziom&quot;) +
  ylab(&quot;Rok&quot;) +
  ggtitle(&quot;Odsetek dni w roku z danym poziomem stężenia pyłu PM10&quot;) +
  labs(caption = &quot;Łukasz Wawrowski - wawrowski.edu.pl&quot;) +
  theme_light() +
  theme(plot.caption = element_text(color = &quot;grey80&quot;))</code></pre>
<p><img src="/post/2020-01-24-smog-w-pszczynie-a-temperatura_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Wniosek z powyższego wykresu nie jest zbyt pokrzepiający - tylko przez co najwyżej 71% dni w roku można cieszyć się w miarę czystym powietrzem. Z kolei 1/3 dni w roku to dni z poziomem powyżej 50 jednostek.</p>
<p>Kolejny wykres przedstawia wykresy pudełkowe stężenia PM10 w podziale na lata i kwartały. Wykresy pudełkowe przedstawiają rozkład w postaci wartości minimalnej, kwartyla dolnego (25% obserwacji poniżej, 75% obserwacji powyżej), mediany (50% obserwacji poniżej, 50% obserwacji powyżej), kwartyla górnego (75% obserwacji poniżej, 25% obserwacji powyżej) oraz maksimum.</p>
<pre class="r"><code>pm10_pszczyna %&gt;% 
  filter(!is.na(pm10)) %&gt;% 
  ggplot(aes(x=rok, y=pm10, fill=kwartal)) +
  geom_boxplot() +
  scale_fill_discrete(name = &quot;Kwartał&quot;) +
  xlab(&quot;Rok&quot;) +
  ylab(&quot;Stężenie PM10&quot;) +
  ggtitle(&quot;Rozkład stężenia pyłu PM10 w ujęciu kwartalnym w latach 2015-2019&quot;) +
  labs(caption = &quot;Łukasz Wawrowski - wawrowski.edu.pl&quot;) +
  theme_light() +
  theme(legend.position = &quot;bottom&quot;,
        plot.caption = element_text(color = &quot;grey80&quot;))</code></pre>
<p><img src="/post/2020-01-24-smog-w-pszczynie-a-temperatura_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Wykres przedstawia wyraźną tendencję występowania wysokich wartości PM10 w pierwszym i czwartym kwartale. Z kolei w drugich i czwartych kwartałach wartości maksymalne nieznacznie wykraczają ponad wartość 100, natomiast mediana nigdy nie przekracza przyjętego jako norma poziomu 50.</p>
</div>
<div id="temperatura-powietrza" class="section level1">
<h1>Temperatura powietrza</h1>
<p>W drugiej części analizy wykorzystamy dane dotyczące temperatury.</p>
<pre class="r"><code>library(imgw)

d &lt;- meteo_daily(rank = &quot;climate&quot;, year = 2015:2019)

imgw_pszczyna &lt;- d %&gt;% 
  filter(station == &quot;PSZCZYNA&quot;) %&gt;% 
  mutate(data=as_date(str_c(yy,&quot;-&quot;,mm,&quot;-&quot;,day)))</code></pre>
<p>W momencie publikacji tego wpisu nie były dostępne dane za grudzień 2019. Zbiór danych zawiera wiele różnych cech takich jak: temperatura, wilgotność, wysokość pokrywy śnieżnej czy stopień zachmurzenia. Szczęśliwie zbiór nie zawiera braków danych. Interesującą nas zmienną będzie średnia dobowa temperatura, której wykres przedstawiony jest poniżej.</p>
<pre class="r"><code>ggplot(imgw_pszczyna, aes(x=data, y=t2m_mean_daily)) +
  geom_point(color = &quot;deepskyblue2&quot;) +
  xlab(&quot;Rok&quot;) +
  ylab(&quot;Średnia dobowa temperatura&quot;) +
  ggtitle(&quot;Średnia dobowa temperatura w latach 2015-2019&quot;) +
  labs(caption = &quot;Łukasz Wawrowski - wawrowski.edu.pl&quot;) +
  theme_light() +
  theme(legend.position = &quot;bottom&quot;,
        plot.caption = element_text(color = &quot;grey80&quot;))</code></pre>
<p><img src="/post/2020-01-24-smog-w-pszczynie-a-temperatura_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Podobnie jak w przypadku stężenia PM10 dla średniej dobowej temperatury można stwierdzić występowanie sezonowości.</p>
</div>
<div id="jakosc-powietrza-a-temperatura-powietrza" class="section level1">
<h1>Jakość powietrza a temperatura powietrza</h1>
<p>Wykorzystamy teraz zebrane dane do poszukania zależności pomiędzy stężeniem PM10 a temperaturą. W pierwszej kolejności zestawimy te dane na wykresie punktowym.</p>
<pre class="r"><code>pm10_imgw &lt;- select(imgw_pszczyna, data, t2m_mean_daily) %&gt;% 
  inner_join(., select(pm10_pszczyna, data, pm10), by=&quot;data&quot;) %&gt;% 
  filter(!is.na(pm10))

ggplot(pm10_imgw, aes(y=pm10, x=t2m_mean_daily)) +
  geom_point() +
  ylab(&quot;Stężenie PM10&quot;) +
  xlab(&quot;Średnia dobowa temperatura&quot;) +
  ggtitle(&quot;Zależność pomiędzy stężeniem PM10 i średnią dobową temperaturą \nw latach 2015-2019&quot;)+
  labs(caption = &quot;Łukasz Wawrowski - wawrowski.edu.pl&quot;) +
  theme_light() +
  theme(plot.caption = element_text(color = &quot;grey80&quot;))</code></pre>
<p><img src="/post/2020-01-24-smog-w-pszczynie-a-temperatura_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Nie można tu wskazać zależności liniowej - są dni z niską temperaturą i niskim stężeniem PM10, a także takie, gdzie to stężenie jest bardzo wysokie. Faktem jest natomiast, że w upalne dni stężenie PM10 jest niskie. Obliczenie współczynnika korelacji liniowej Pearsona wskazuje na wartość <span class="math inline">\(r=-0,53\)</span> czyli umiarkowaną zależność ujemną.</p>
<p>Na kolejnym wykresie zestawimy obie analizowane cechy z uwzględnieniem czasu.</p>
<pre class="r"><code>pm10_imgw %&gt;% 
  pivot_longer(-data) %&gt;% 
  mutate(name=factor(name, 
                     levels = c(&quot;pm10&quot;, &quot;t2m_mean_daily&quot;), 
                     labels = c(&quot;PM10&quot;, &quot;Temperatura&quot;))) %&gt;% 
  ggplot(aes(x=data, y=value, color=name)) +
  geom_point(alpha = 0.5) +
  scale_color_manual(name = &quot;&quot;, values = c(&quot;grey50&quot;, &quot;deepskyblue2&quot;)) +
  xlab(&quot;Rok&quot;) +
  ylab(&quot;Wartość cechy&quot;) +
  ggtitle(&quot;Stężenie PM10 i średnia dobowa temperatura w latach 2015-2019&quot;) +
  labs(caption = &quot;Łukasz Wawrowski - wawrowski.edu.pl&quot;) +
  theme_light() +
  theme(legend.position = &quot;bottom&quot;,
        plot.caption = element_text(color = &quot;grey80&quot;))</code></pre>
<p><img src="/post/2020-01-24-smog-w-pszczynie-a-temperatura_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Widoczne jest wzajemne przeciwstawianie się obserwacji, natomiast ze względu na to, że te cechy są mierzone na różnych skalach to trudno te wielkości porównywać. Zatem zostanie zastosowana standaryzacja, co umożliwi porównanie wartości cech.</p>
<pre class="r"><code>pm10_imgw_std &lt;- select(imgw_pszczyna, data, t2m_mean_daily) %&gt;% 
  inner_join(., select(pm10_pszczyna, data, pm10), by=&quot;data&quot;) %&gt;% 
  filter(!is.na(pm10)) %&gt;% 
  mutate_if(is.numeric, scale) %&gt;% 
  pivot_longer(-data) %&gt;% 
  mutate(name=factor(name, 
                     levels = c(&quot;pm10&quot;, &quot;t2m_mean_daily&quot;), 
                     labels = c(&quot;PM10&quot;, &quot;Temperatura&quot;)))

ggplot(pm10_imgw_std, aes(x=data, y=value, color=name)) +
  geom_point(alpha = 0.5) +
  # geom_smooth(se = F, size = 2) +
  scale_color_manual(name = &quot;&quot;, values = c(&quot;grey50&quot;, &quot;deepskyblue2&quot;)) +
  xlab(&quot;Rok&quot;) +
  ylab(&quot;Standaryzowana wartość cechy&quot;) +
  ggtitle(&quot;Stężenie PM10 i średnia dobowa temperatura w latach 2015-2019&quot;) +
  labs(caption = &quot;Łukasz Wawrowski - wawrowski.edu.pl&quot;) +
  theme_light() +
  theme(legend.position = &quot;bottom&quot;,
        plot.caption = element_text(color = &quot;grey80&quot;))</code></pre>
<p><img src="/post/2020-01-24-smog-w-pszczynie-a-temperatura_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Na powyższej grafice widać wyraźnie, że podczas dni z wysoką temperaturą powietrza poziom stężenia PM10 utrzymuje się na niskim poziomie. Z kolei spadek temperatury w większości przypadków pociąga za sobą wzrost stężenia PM10.</p>
</div>
<div id="podsumowanie" class="section level1">
<h1>Podsumowanie</h1>
<p>W tym poście zostały przedstawione tylko dwie cechy - poziom pyłów PM10 oraz średnia dobowa temperatura powietrza. W analizie smogu należałoby uwzględnić także inne cechy związane z warunkami atmosferycznymi. Na podstawie wielu takich czynników można pokusić się o stworzenie modelu prognozującego stężenie pyłów PM10.</p>
</div>
