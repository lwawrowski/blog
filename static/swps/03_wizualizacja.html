<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Język R</title>
    <meta charset="utf-8" />
    <meta name="author" content="© Łukasz Wawrowski" />
    <link href="libs/countdown-0.3.3/countdown.css" rel="stylesheet" />
    <script src="libs/countdown-0.3.3/countdown.js"></script>
    <link rel="stylesheet" href="default.css" type="text/css" />
    <link rel="stylesheet" href="default-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Język R
## Wizualizacja danych
### © Łukasz Wawrowski
### Dzień 3/6

---




class: inverse

# Zadanie

Po wczytaniu zbioru danych `gus.RData` połącz ze sobą zbiory danych zawierające informacje o liczbie przedsiębiorstw na 10 tys. mieszkańców (zbiór _pod_10tys_), stopie bezrobocia (zbiór _bezrobocie_) oraz wynagrodzeniu (zbiór _wyn_).

<div class="countdown" id="timer_5d89274b" style="top:0;right:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Źródła wiedzy

- [Przewodnik po wizualizacji danych](https://www.data-to-viz.com/)

- [Fundamentals of Data Visualization](https://serialmentor.com/dataviz/)

- [Color Brewer](http://colorbrewer2.org)

---

# Proste wykresy

- `plot()` - wykres punktowy/liniowy

- `hist()` - histogram

- `barplot()` - wykres kolumnowy

- `boxplot()` - wykres pudełkowy

---

class: inverse

# Wczytanie danych

1. Ściągnij zbiór `poz_sop.sav` i umieść w folderze `data`

2. Utwórz nowy skrypt i wczytaj biblioteki `tidyverse` i `haven`

3. Wczytaj zbiór danych `poz_sop.sav` do pamięci R

4. Stwórz kilka wykresów

<div class="countdown" id="timer_5d8927af" style="top:0;right:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

???


```r
library(tidyverse)
library(haven)
```

```
## Warning: package 'haven' was built under R version 3.6.1
```

```r
poz &lt;- read_sav("data/poz_sop.sav")
poz &lt;- janitor::clean_names(poz)
```


---

# Problemy z nazwami zmiennych

- nazwy zmiennych nie powinny zawierać polskich liter i spacji

- nazwy zmiennych nie powinny zaczynać się od liczby

- surowe dane zwykle nie posiadają nazw kolumn przystosowanych do przetwarzania przez komputer

- ten problem rozwiązuje pakiet _janitor_ i funkcja `clean_names()`:

```

zbior &lt;- janitor::clean_names(zbior)

```

- funkcja ta zamienia wielkie litery na małe, spacje na podkreślniki i znaki transliteruje do ASCII.

---

# Pakiet `ggplot2`

Tworzenie wykresów poprzez dodawanie (`+`) kolejnych warstw.

- [dokumentacja](https://ggplot2.tidyverse.org/)

- [cheatsheet](https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf)

- [rozszerzenia](http://www.ggplot2-exts.org/gallery/)

- [top 50](http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html)

- [wykresy krok po kroku](https://evamaerey.github.io/ggplot_flipbook/ggplot_flipbook_xaringan.html)

???

Pierwsza wersja 10.06.2007

---

# Niezbędny kod


```r
ggplot(data = zbior_danych, aes(x = cecha1, y=cecha2))
```


- x - zawartość osi x

- y - zawartość osi y

- fill - wypełnienie

- size - rozmiar

- color - kolor

- shape - kształt

---

# Wykres punktowy - `geom_point`

Obowiązkowe argumenty `aes`:

- x 

- y

---

# Wykres punktowy

.pull-left[


```r
ggplot(poz, aes(x=ps, y=perf_cmda)) + 
  geom_point()
```

]

.pull-right[

![](03_wizualizacja_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;

]

---

# Dodatkowe elementy

- `xlim(0,10)` - minimum i maksimum osi x

- `ylim(-5,5)` - minimum i maksimum osi y

- `xlab("tekst")` - etykieta osi x

- `ylab("tekst")` - etykieta osi y

- `ggtitle("tekst")` - tytuł wykresu

- `labs(subtitle = "tekst")` - podtytuł

- `labs(caption = "tekst")` - podpis

- `coord_flip()` - obraca wykres

---

# Zapisywanie wykresu

- w zakładce Plots -&gt; Export

- funkcja `ggsave()`

   - `filename` - nazwa pliku z rozszerzeniem (png, pdf)
   
   - `width` i `height` - szerokość i wysokość (domyślnie w calach)

---

# Motywy

- theme_bw
- theme_classic
- theme_dark
- theme_gray - domyślnie
- theme_light
- theme_linedraw
- theme_minimal
- theme_void

Powyższe motywy są zaimplementowane w pakiecie ggplot2, ale można także skorzystać z dodatkowych pakietów:

- [theme_bbc](https://github.com/bbc/bbplot)
- [theme_xkcd](https://cran.r-project.org/web/packages/xkcd/)

Albo stworzyć [swój własny motyw](https://www.statworx.com/de/blog/custom-themes-in-ggplot2/).

---

class: inverse

# Zadanie 

Przetestuj kilka motywów i wybierz jeden z nich.

<div class="countdown" id="timer_5d892b0f" style="top:0;right:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Histogram - `geom_histogram`

Obowiązkowe argumenty `aes`:

- x 

Domyślnie tworzy zawsze 30 słupków.

---

# Histogram

.pull-left[


```r
ggplot(poz, aes(x=ps)) + 
  geom_histogram(binwidth = 0.2)
```

]

.pull-right[

![](03_wizualizacja_files/figure-html/unnamed-chunk-7-1.png)&lt;!-- --&gt;

]


---

# Krzywa gęstości

.pull-left[


```r
ggplot(poz, aes(x=ps)) + 
  geom_histogram(binwidth = 0.2) +
  stat_function(fun = dnorm, size = 2, 
      args = list(mean = mean(poz$ps), 
                  sd = sd(poz$ps)))
```


]

.pull-right[

![](03_wizualizacja_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;


]

---

# Wykres kwantyl-kwantyl

.pull-left[


```r
ggplot(poz, aes(sample=ps)) + 
  stat_qq() + 
  stat_qq_line()
```

]

.pull-right[

![](03_wizualizacja_files/figure-html/unnamed-chunk-11-1.png)&lt;!-- --&gt;

]


---

# Szeroka i wąska reprezentacja danych

![](img/wide_long.png)

[źródło](https://www.datasciencemadesimple.com%2Freshape-in-r-from-wide-to-long-from-long-to-wide)

---

# Wide -&gt; long - `gather()`

- `key` - nazwa nowej kolumny z nazwami zmiennych

- `value` - nazwa nowej kolumny z wartościami zmiennych

---

# Long -&gt; wide - `spread()`

- `key` - nazwa kolumny zawierającej nazwy dla nowych zmiennych

- `value` - nazwa kolumny zawierającej wartości dla nowych zmiennych

---

class: inverse

# Zadanie

Dodaj do zbioru danych identyfikator jednostek.

<div class="countdown" id="timer_5d8929b4" style="top:0;right:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

# Wykres pudełkowy - `geom_boxplot`

Obowiązkowe argumenty `aes`:

- x - zmienna grupująca

- y - zmienna analizowana

---

class: inverse

# Zadanie

1. Zamień kody płci na odpowiednie etykiety.

2. Stwórz zmienną `wiek4`, która będzie zawierała 4 grupy wieku.

<div class="countdown" id="timer_5d892864" style="top:0;right:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

???


```r
poz &lt;- poz %&gt;%
  mutate(plec=factor(plec, levels = c(1,2), labels = c("Kobieta", "Mężczyzna")))

poz &lt;- poz %&gt;%
  mutate(wiek4 = cut(wiek, breaks = c(18,24,30,36,42), include.lowest = T))
```


---

# Wykres słupkowy - `geom_bar` / `geom_col`

- dane jednostkowe - `geom_bar` - funkcja sama oblicza wartości do wyświetlenia

- dane zagregowane - `geom_col` - funkcja otrzymuje już obliczone wartości

---

# Wykres kafelkowy - `geom_tile()`

Obowiązkowe argumenty `aes`:

- x - zmienna grupująca

- y - zmienna grupująca

- fill - zmienna wypełniająca

---

# Facets

- facet_wrap

- facet_grid

---

# Wykresy interaktywne

Plotly to biblioteka do wykresów, która posiada swoją własną składnię.

Za pomocą funkcji `ggplotly()` można zamienić każdy wykres ggplot2 na wykres interaktywny.

---

class: inverse

# Zadanie domowe

Na podstawie zbioru `pgss2.RData` przeprowadź analizę liczby braków danych dla zmiennych oraz respondentów. Wyniki przedstaw na wykresach.

???


```r
load("data/pgss.RData")

pgss2 &lt;- pgss %&gt;%
  select(recordid:q37)

save(pgss2, file="data/pgss2.RData")
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
